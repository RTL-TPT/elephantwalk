
<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Basic Example</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width">
        <link rel="stylesheet" href="assets/css/main.css">
        
        <link rel="apple-touch-icon" sizes="180x180" href="favicons/apple-touch-icon.png">
        <link rel="icon" type="image/png" href="favicons/favicon-32x32.png" sizes="32x32">
        <link rel="icon" type="image/png" href="favicons/favicon-16x16.png" sizes="16x16">
        <link rel="manifest" href="favicons/manifest.json">
        <link rel="mask-icon" href="favicons/safari-pinned-tab.svg" color="#5bbad5">
        <meta name="theme-color" content="#ffffff">

        <!-- style fps counter for debug -->
        <style>#framerate{position:absolute;background:rgba(255,255,255,0.75);pointer-events:none;}</style>

        <!-- External dependencies -->
        <script src="components/preloadjs/lib/preloadjs.min.js"></script>
        <script src="components/easeljs/lib/easeljs.combined.js"></script>

        <!-- Library and modules -->
        <script src="dist/core.js"></script>
        <script src="dist/modules/debug.js"></script>
        <script src="dist/modules/easeljs-display.js"></script>
        <script src="dist/modules/easeljs-ui.js"></script>
        <script src="dist/modules/states.js"></script>

        <!-- Game methods -->
        <script src="assets/js/utils.js"></script>
        <script src="assets/js/map.js"></script>
        <script src="assets/js/exploration.js"></script>
        <script src="assets/js/clues.js"></script>
    </head>
    <body class="md">
        <div id="content" class="canvas">
            <canvas id="stage" width="1024" height="768" style="border: 2px solid gray"></canvas>
            <script>

                // Include classes
                var Application = include('springroll.Application'),
                    Button = include('springroll.easeljs.Button'),
                    EaselJSDisplay = include('springroll.EaselJSDisplay'),
                    Bitmap = include('createjs.Bitmap'),
                    Container = include('createjs.Container'),
                    Shape = include('createjs.Shape'),
                    Text = include('createjs.Text'),
                    State = include('springroll.State');

                function getLevel() {
                    return {
                        id: 'level1-easy',
                        tutorial: true,
                        tiles: [
                            ['forest-mountain', 'hill-mountain'],
                            ['desert-forest',   'desert-hill']
                        ],
                        elephantLocations: [['hill-mountain', 'south'],
                                            ['desert-hill', 'south']],
                        symbols: {
                            mountain: {
                                unlocked: ['non-abstract'],
                                assetName: 'non-abstract',
                                x: 184,
                                y: 42,
                            },
                            forest: {
                                assetName: 'non-abstract',
                                x: 138,
                                y: 270,
                            },
                            hill: {
                                unlocked: ['non-abstract'],
                                assetName: 'non-abstract',
                                x: 557,
                                y: 275,
                            },
                            desert: {
                                unlocked: ['non-abstract'],
                                assetName: 'non-abstract',
                                x: 330,
                                y: 454,
                            },
                        },
                        tileWidth: 471,
                        tileHeight: 308,
                    }
                }

                const CANVAS_HEIGHT = 768;
                const CANVAS_WIDTH = 1024;
                const CANVAS_PADDING = 10;
                const LEVEL_DIFFICULTIES = ['easy', 'medium', 'hard'];
                const SYMBOL_ABSTRACTIONS = ['non-abstract', 'partial-abstract', 'full-abstract'];
                const TILE_DIRECTIONS = ['west', 'north', 'east', 'south'];
                const TILE_WIDTH = getLevel().tileWidth;
                const TILE_HEIGHT = getLevel().tileHeight;
                const PANE_WIDTH = 950;
                const PANE_HEIGHT = 620;
                const PANE_PADDING = 45;

                // Create the new application
                var app = new Application({
                    canvasId: "stage",
                    state: 'level',
                    debug: true,
                    display: EaselJSDisplay,
                    displayOptions: {
                        clearView: true
                    },
                    // Add the manifest with the loading event to make sure
                    // assets are loaded before the application is init
                    // all preload assets are automatically cached
                    preload: [
                        {
                            id: 'left-arrow',
                            src: 'assets/images/left-arrow.png',
                            format: 'createjs.Bitmap',
                        },
                        {
                            id: 'right-arrow',
                            src: 'assets/images/right-arrow.png',
                            format: 'createjs.Bitmap',
                        },
                        {
                            id: 'player-icon',
                            src: 'assets/images/player-icon.png',
                            format: 'createjs.Bitmap',
                        },
                        {
                            id: 'done-button',
                            src: 'assets/images/done-button.png',
                            format: 'createjs.Bitmap',
                        },
                    ],
                });

                var fitCanvasToWindow = function() {
                    var canvasOffset = 20;
                    if(window.innerHeight * (4/3) > window.innerWidth) {
                        document.getElementById("stage").style.height = Math.floor((window.innerWidth - canvasOffset) * (3/4)) + "px";
                        document.getElementById("stage").style.width = window.innerWidth - canvasOffset + "px";
                    } else {
                        document.getElementById("stage").style.height = window.innerHeight - canvasOffset + "px";
                        document.getElementById("stage").style.width = Math.floor((window.innerHeight - canvasOffset) * (4/3)) + "px";
                    }
                };

                // Wait until the app is ready
                app.once('init', function() {
                    this.states = {
                        level: getLevelState(),
                        clues: getClueState(),
                    };
                    this.levelInfo = {};  // Keeps track of level info across states
                    this.gameInfo = {};   // Keeps track of game info (i.e. unlocks earned) across levels

                    fitCanvasToWindow();
                });

                //resize to window but maintain 4:3 aspect ratio
                window.addEventListener("resize", function(){
                    fitCanvasToWindow();
                });
            </script>
        </div>
    </body>
</html>
